<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨è¯åˆ—è¡¨ - è¨€è‘‰AI</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.0/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fdf2f8 0%, #e0f2fe 100%);
        }
        .verb-cell {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        .kanji-part {
            color: #666;
        }
        .reading-part {
            color: #333;
            font-weight: 500;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex-1">
                <a href="../index.html" class="btn btn-ghost text-xl">
                    <span class="text-2xl">ğŸŒ¸</span>
                    <span class="font-bold">è¨€è‘‰AI</span>
                </a>
            </div>
            <div class="flex-none">
                <a href="../index.html" class="btn btn-ghost btn-sm">â† è¿”å›é¦–é¡µ</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-2">ğŸ”¤ åŠ¨è¯åˆ—è¡¨</h1>
        <p class="text-gray-600 text-center mb-8">å·²æŒæ¡ <span id="verbCount" class="font-bold text-primary">0</span> ä¸ªåŠ¨è¯</p>

        <!-- åŠ è½½çŠ¶æ€ -->
        <div id="loadingState" class="flex justify-center items-center py-20">
            <span class="loading loading-spinner loading-lg text-primary"></span>
            <span class="ml-4 text-gray-500">åŠ è½½ä¸­...</span>
        </div>

        <!-- åŠ¨è¯è¡¨æ ¼ -->
        <div id="verbTable" class="card bg-white shadow-xl" style="display: none;">
            <div class="card-body p-0">
                <div class="overflow-x-auto">
                    <table class="table table-zebra w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="text-left py-4 px-6">åŠ¨è¯åŸå‹</th>
                                <th class="text-left py-4 px-6">ä¸­æ–‡</th>
                                <th class="text-left py-4 px-6">å¹³å‡åè¯»éŸ³</th>
                                <th class="text-left py-4 px-6">ç½—é©¬éŸ³</th>
                                <th class="text-left py-4 px-6">ç¤¼è²Œä½“</th>
                                <th class="text-left py-4 px-6">ç¤¼è²Œä½“ç½—é©¬éŸ³</th>
                                <th class="text-left py-4 px-6">åè¯ä½“</th>
                                <th class="text-left py-4 px-6">åè¯ä½“ç½—é©¬éŸ³</th>
                            </tr>
                        </thead>
                        <tbody id="verbTableBody">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div id="emptyState" class="text-center py-20" style="display: none;">
            <div class="text-6xl mb-4">ğŸ“­</div>
            <p class="text-gray-500 mb-4">æš‚æ— åŠ¨è¯æ•°æ®</p>
            <a href="input.html" class="btn btn-primary">å»å½•å…¥</a>
        </div>
    </main>

    <script>
        // æå–æ±‰å­—ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        function extractKanji(prototype) {
            // ç®€å•çš„æå–ï¼šå¦‚æœæœ‰æ‹¬å·ï¼Œæå–æ‹¬å·å†…çš„å†…å®¹
            const match = prototype.match(/([^(]+)(?:\(([^)]+)\))?/);
            if (match) {
                const hiragana = match[1].trim();
                const kanji = match[2] ? match[2].trim() : '';
                return { hiragana, kanji };
            }
            return { hiragana: prototype, kanji: '' };
        }

        // æ ¼å¼åŒ–åŠ¨è¯æ˜¾ç¤ºï¼ˆå¹³å‡å + æ±‰å­—ï¼‰
        function formatVerb(prototype) {
            const { hiragana, kanji } = extractKanji(prototype);
            if (kanji) {
                return `<span class="reading-part">${hiragana}</span> <span class="kanji-part">ï¼ˆ${kanji}ï¼‰</span>`;
            }
            return `<span class="reading-part">${hiragana}</span>`;
        }

        // ç®€å•çš„å¹³å‡åè½¬ç½—é©¬éŸ³å‡½æ•°
        function hiraganaToRomaji(hiragana) {
            const map = {
                'ã‚': 'a', 'ã„': 'i', 'ã†': 'u', 'ãˆ': 'e', 'ãŠ': 'o',
                'ã‹': 'ka', 'ã': 'ki', 'ã': 'ku', 'ã‘': 'ke', 'ã“': 'ko',
                'ãŒ': 'ga', 'ã': 'gi', 'ã': 'gu', 'ã’': 'ge', 'ã”': 'go',
                'ã•': 'sa', 'ã—': 'shi', 'ã™': 'su', 'ã›': 'se', 'ã': 'so',
                'ã–': 'za', 'ã˜': 'ji', 'ãš': 'zu', 'ãœ': 'ze', 'ã': 'zo',
                'ãŸ': 'ta', 'ã¡': 'chi', 'ã¤': 'tsu', 'ã¦': 'te', 'ã¨': 'to',
                'ã ': 'da', 'ã¢': 'ji', 'ã¥': 'zu', 'ã§': 'de', 'ã©': 'do',
                'ãª': 'na', 'ã«': 'ni', 'ã¬': 'nu', 'ã­': 'ne', 'ã®': 'no',
                'ã¯': 'ha', 'ã²': 'hi', 'ãµ': 'fu', 'ã¸': 'he', 'ã»': 'ho',
                'ã°': 'ba', 'ã³': 'bi', 'ã¶': 'bu', 'ã¹': 'be', 'ã¼': 'bo',
                'ã±': 'pa', 'ã´': 'pi', 'ã·': 'pu', 'ãº': 'pe', 'ã½': 'po',
                'ã¾': 'ma', 'ã¿': 'mi', 'ã‚€': 'mu', 'ã‚': 'me', 'ã‚‚': 'mo',
                'ã‚„': 'ya', 'ã‚†': 'yu', 'ã‚ˆ': 'yo',
                'ã‚‰': 'ra', 'ã‚Š': 'ri', 'ã‚‹': 'ru', 'ã‚Œ': 're', 'ã‚': 'ro',
                'ã‚': 'wa', 'ã‚’': 'wo', 'ã‚“': 'n',
                'ãã‚ƒ': 'kya', 'ãã‚…': 'kyu', 'ãã‚‡': 'kyo',
                'ãã‚ƒ': 'gya', 'ãã‚…': 'gyu', 'ãã‚‡': 'gyo',
                'ã—ã‚ƒ': 'sha', 'ã—ã‚…': 'shu', 'ã—ã‚‡': 'sho',
                'ã˜ã‚ƒ': 'ja', 'ã˜ã‚…': 'ju', 'ã˜ã‚‡': 'jo',
                'ã¡ã‚ƒ': 'cha', 'ã¡ã‚…': 'chu', 'ã¡ã‚‡': 'cho',
                'ã«ã‚ƒ': 'nya', 'ã«ã‚…': 'nyu', 'ã«ã‚‡': 'nyo',
                'ã²ã‚ƒ': 'hya', 'ã²ã‚…': 'hyu', 'ã²ã‚‡': 'hyo',
                'ã³ã‚ƒ': 'bya', 'ã³ã‚…': 'byu', 'ã³ã‚‡': 'byo',
                'ã´ã‚ƒ': 'pya', 'ã´ã‚…': 'pyu', 'ã´ã‚‡': 'pyo',
                'ã¿ã‚ƒ': 'mya', 'ã¿ã‚…': 'myu', 'ã¿ã‚‡': 'myo',
                'ã‚Šã‚ƒ': 'rya', 'ã‚Šã‚…': 'ryu', 'ã‚Šã‚‡': 'ryo',
                'ã£': '', 'ã‚ƒ': 'ya', 'ã‚…': 'yu', 'ã‚‡': 'yo'
            };
            
            let romaji = '';
            let i = 0;
            while (i < hiragana.length) {
                // å°è¯•åŒ¹é…2ä¸ªå­—ç¬¦ï¼ˆæ‹—éŸ³ï¼‰
                if (i + 1 < hiragana.length) {
                    const twoChars = hiragana.substring(i, i + 2);
                    if (map[twoChars]) {
                        romaji += map[twoChars];
                        i += 2;
                        continue;
                    }
                }
                // åŒ¹é…å•ä¸ªå­—ç¬¦
                const char = hiragana[i];
                romaji += map[char] || char;
                i++;
            }
            return romaji;
        }

        // è·å–ç¤¼è²Œä½“ï¼ˆã¾ã™å½¢ï¼‰- è¿”å›å¯¹è±¡åŒ…å«æ˜¾ç¤ºæ–‡æœ¬å’Œå¹³å‡å
        function getPoliteForm(conjugations) {
            const masu = conjugations['masu'];
            if (masu) {
                // æ˜¾ç¤ºç”¨ form_valueï¼ˆå¯èƒ½å«æ±‰å­—ï¼‰ï¼Œç½—é©¬éŸ³ç”¨ readingï¼ˆçº¯å¹³å‡åï¼‰
                const displayText = `<span class="reading-part">${masu.form_value}</span>`;
                const hiragana = masu.reading || ''; // ä½¿ç”¨çº¯å¹³å‡å
                return { displayText, hiragana };
            }
            return { displayText: '-', hiragana: '' };
        }

        // è·å–åè¯ä½“ï¼ˆåŸå‹+ã“ã¨ï¼‰- è¿”å›å¯¹è±¡åŒ…å«æ˜¾ç¤ºæ–‡æœ¬å’Œå¹³å‡å
        function getNounForm(prototype, reading) {
            // æ˜¾ç¤ºç”¨ï¼šåŸå‹+ã“ã¨ï¼ˆå¯èƒ½å«æ±‰å­—ï¼‰
            const { hiragana: protoHira, kanji } = extractKanji(prototype);
            let displayText;
            if (kanji) {
                displayText = `<span class="reading-part">${protoHira}ã“ã¨</span> <span class="kanji-part">ï¼ˆ${kanji}ã“ã¨ï¼‰</span>`;
            } else {
                displayText = `<span class="reading-part">${protoHira}ã“ã¨</span>`;
            }
            // ç½—é©¬éŸ³ç”¨ï¼šreading + ã“ã¨ï¼ˆçº¯å¹³å‡åï¼‰
            const nounHiragana = (reading || protoHira) + 'ã“ã¨';
            return { displayText, hiragana: nounHiragana };
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const response = await fetch('/api/verbs');
                const result = await response.json();

                if (!result.success) {
                    showError('åŠ è½½å¤±è´¥');
                    return;
                }

                const verbs = result.data.verbs;
                document.getElementById('verbCount').textContent = verbs.length;

                if (verbs.length === 0) {
                    showEmpty();
                    return;
                }

                renderTable(verbs);

            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                showError('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            }
        });

        function renderTable(verbs) {
            const tbody = document.getElementById('verbTableBody');
            tbody.innerHTML = '';

            verbs.forEach(verb => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const prototype = formatVerb(verb.prototype);
                const meaning = verb.meaning || '-';
                const hiraganaReading = verb.reading || '-';
                const romaji = hiraganaToRomaji(hiraganaReading);
                
                const politeFormData = getPoliteForm(verb.conjugations);
                const politeForm = politeFormData.displayText;
                const politeRomaji = hiraganaToRomaji(politeFormData.hiragana);
                
                const nounFormData = getNounForm(verb.prototype, verb.reading);
                const nounForm = nounFormData.displayText;
                const nounRomaji = hiraganaToRomaji(nounFormData.hiragana);
                
                row.innerHTML = `
                    <td class="verb-cell py-4 px-6">${prototype}</td>
                    <td class="verb-cell py-4 px-6">${meaning}</td>
                    <td class="verb-cell py-4 px-6">${hiraganaReading}</td>
                    <td class="verb-cell py-4 px-6 text-gray-600">${romaji}</td>
                    <td class="verb-cell py-4 px-6">${politeForm}</td>
                    <td class="verb-cell py-4 px-6 text-gray-600">${politeRomaji}</td>
                    <td class="verb-cell py-4 px-6">${nounForm}</td>
                    <td class="verb-cell py-4 px-6 text-gray-600">${nounRomaji}</td>
                `;
                
                tbody.appendChild(row);
            });

            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('verbTable').style.display = 'block';
        }

        function showEmpty() {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }

        function showError(message) {
            document.getElementById('loadingState').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
            document.getElementById('emptyState').innerHTML = `
                <div class="text-6xl mb-4">âŒ</div>
                <p class="text-gray-500 mb-4">${message}</p>
            `;
        }
    </script>
</body>
</html>
