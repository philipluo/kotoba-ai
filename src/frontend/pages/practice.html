<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯æ—¥ä¸€ç»ƒ - è¨€è‘‰AI</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.0/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #fdf2f8 0%, #e0f2fe 100%);
        }
        .question-card {
            transition: all 0.3s ease;
        }
        .option-btn:hover {
            transform: translateX(4px);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex-1">
                <a href="../index.html" class="btn btn-ghost text-xl">
                    <span class="text-2xl">ğŸŒ¸</span>
                    <span class="font-bold">è¨€è‘‰AI</span>
                </a>
            </div>
            <div class="flex-none">
                <a href="../index.html" class="btn btn-ghost btn-sm">â† è¿”å›é¦–é¡µ</a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8">
        <!-- è¿›åº¦å¤´éƒ¨ -->
        <div class="card bg-white shadow-lg mb-8">
            <div class="card-body">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div>
                        <h1 class="text-2xl font-bold mb-2">ğŸ¯ æ¯æ—¥ä¸€ç»ƒ</h1>
                        <p class="text-gray-600">ä»Šæ—¥ç»ƒä¹  - <span id="currentDate"></span></p>
                    </div>
                    <div class="mt-4 md:mt-0 text-center">
                        <div class="text-3xl font-bold text-primary">
                            <span id="currentQuestion">0</span> / <span id="totalQuestions">20</span>
                        </div>
                        <div class="text-sm text-gray-500">é¢˜ç›®è¿›åº¦</div>
                    </div>
                </div>
                <progress class="progress progress-primary w-full mt-4" id="progressBar" value="0" max="20"></progress>
            </div>
        </div>

        <!-- ç»ƒä¹ åŒºåŸŸ -->
        <div id="practiceArea" class="max-w-3xl mx-auto">
            <!-- é¢˜ç›®å¡ç‰‡ -->
            <div class="card bg-white shadow-xl question-card" id="questionCard">
                <div class="card-body">
                    <div class="flex justify-between items-start mb-4">
                        <span class="badge badge-primary" id="questionType">ç¿»è¯‘é¢˜</span>
                        <span class="text-sm text-gray-400" id="questionNumber">ç¬¬1é¢˜</span>
                    </div>

                    <h3 class="text-xl font-bold mb-6" id="questionText"></h3>

                    <!-- é€‰é¡¹åŒºåŸŸ -->
                    <div id="optionsArea" class="space-y-3">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>

                    <!-- æç¤º -->
                    <div class="alert alert-info mt-6" id="hintArea" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span id="hintText"></span>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="flex justify-between mt-6">
                        <button class="btn btn-ghost" onclick="showHint()">
                            ğŸ’¡ æç¤º
                        </button>
                        <button class="btn btn-primary" onclick="nextQuestion()">
                            ä¸‹ä¸€é¢˜ â†’
                        </button>
                    </div>
                </div>
            </div>

            <!-- å®ŒæˆåŒºåŸŸ -->
            <div class="card bg-white shadow-xl" id="completeArea" style="display: none;">
                <div class="card-body text-center">
                    <div class="text-6xl mb-4">ğŸ‰</div>
                    <h2 class="text-3xl font-bold mb-4">ç»ƒä¹ å®Œæˆï¼</h2>
                    <div class="text-5xl font-bold text-primary mb-4">
                        <span id="correctCount">0</span> / <span id="totalCount">20</span>
                    </div>
                    <p class="text-gray-600 mb-6">æ­£ç¡®ç‡: <span id="accuracy">0%</span></p>

                    <div class="flex gap-4 justify-center">
                        <button class="btn btn-outline" onclick="generatePrompt()">
                            ğŸ’¬ ç”Ÿæˆè±†åŒ…Prompt
                        </button>
                        <a href="../index.html" class="btn btn-primary">
                            è¿”å›é¦–é¡µ
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Promptæ˜¾ç¤ºåŒºåŸŸ -->
        <div class="card bg-gray-800 text-white shadow-xl mt-8" id="promptArea" style="display: none;">
            <div class="card-body">
                <h3 class="card-title text-white mb-4">ğŸ’¬ è±†åŒ…è¯­éŸ³ç»ƒä¹ Prompt</h3>
                <pre class="bg-gray-900 p-4 rounded-lg overflow-x-auto text-sm whitespace-pre-wrap" id="promptText"></pre>
                <div class="flex gap-4 mt-4">
                    <button class="btn btn-primary" onclick="copyPrompt()">
                        ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿
                    </button>
                    <button class="btn btn-ghost" onclick="closePrompt()">
                        å…³é—­
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let questions = [];
        let currentIndex = 0;
        let answers = [];

        // é¡µé¢åŠ è½½æ—¶è·å–é¢˜ç›®
        document.addEventListener('DOMContentLoaded', async function() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('zh-CN');
            await loadQuestions();
        });

        // åŠ è½½é¢˜ç›®
        async function loadQuestions() {
            try {
                const response = await fetch('/api/practice/daily');
                const data = await response.json();

                if (data.success) {
                    questions = data.data.questions;
                    document.getElementById('totalQuestions').textContent = questions.length;
                    document.getElementById('progressBar').max = questions.length;
                    showQuestion(0);
                }
            } catch (error) {
                console.error('åŠ è½½é¢˜ç›®å¤±è´¥:', error);
                // ä½¿ç”¨ç¤ºä¾‹é¢˜ç›®
                loadExampleQuestions();
            }
        }

        // ç¤ºä¾‹é¢˜ç›®
        function loadExampleQuestions() {
            questions = [
                {
                    id: 1,
                    type: 'translation_jp_to_cn',
                    question: 'ç§ã¯å­¦ç”Ÿã§ã™',
                    correct_answer: 'æˆ‘æ˜¯å­¦ç”Ÿ',
                    hint: 'è¯»éŸ³: ã‚ãŸã—ã¯ãŒãã›ã„ã§ã™',
                    options: ['æˆ‘æ˜¯å­¦ç”Ÿ', 'ä½ æ˜¯å­¦ç”Ÿ', 'ä»–æ˜¯å­¦ç”Ÿ']
                },
                {
                    id: 2,
                    type: 'translation_cn_to_jp',
                    question: 'æˆ‘æ˜¯å­¦ç”Ÿ',
                    correct_answer: 'ç§ã¯å­¦ç”Ÿã§ã™',
                    hint: 'è¯»éŸ³: watashi wa gakusei desu',
                    options: ['ç§ã¯å­¦ç”Ÿã§ã™', 'ç§ã¯å…ˆç”Ÿã§ã™', 'å½¼ã¯å­¦ç”Ÿã§ã™']
                }
            ];
            document.getElementById('totalQuestions').textContent = questions.length;
            showQuestion(0);
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion(index) {
            if (index >= questions.length) {
                showComplete();
                return;
            }

            const q = questions[index];
            currentIndex = index;

            // æ›´æ–°è¿›åº¦
            document.getElementById('currentQuestion').textContent = index + 1;
            document.getElementById('progressBar').value = index + 1;
            document.getElementById('questionNumber').textContent = `ç¬¬${index + 1}é¢˜`;

            // æ›´æ–°é¢˜ç›®å†…å®¹
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('hintText').textContent = q.hint || 'æš‚æ— æç¤º';
            document.getElementById('hintArea').style.display = 'none';

            // æ›´æ–°é¢˜å‹æ ‡ç­¾
            const typeMap = {
                'translation_jp_to_cn': 'æ—¥è¯‘ä¸­',
                'translation_cn_to_jp': 'ä¸­è¯‘æ—¥',
                'word_recognition': 'å•è¯è¯†åˆ«',
                'verb_conjugation': 'åŠ¨è¯æ´»ç”¨'
            };
            document.getElementById('questionType').textContent = typeMap[q.type] || 'ç»ƒä¹ é¢˜';

            // ç”Ÿæˆé€‰é¡¹
            const optionsArea = document.getElementById('optionsArea');
            optionsArea.innerHTML = '';

            if (q.options && q.options.length > 0) {
                q.options.forEach((option, i) => {
                    const btn = document.createElement('button');
                    btn.className = 'option-btn btn btn-outline w-full text-left justify-start';
                    btn.textContent = `${String.fromCharCode(65 + i)}. ${option}`;
                    btn.onclick = () => selectOption(option, q.correct_answer);
                    optionsArea.appendChild(btn);
                });
            } else {
                // ç®€ç­”é¢˜è¾“å…¥æ¡†
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'input input-bordered w-full';
                input.placeholder = 'è¯·è¾“å…¥ç­”æ¡ˆ...';
                input.id = 'answerInput';
                optionsArea.appendChild(input);
            }
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(selected, correct) {
            const isCorrect = selected === correct;
            answers.push({
                question_id: questions[currentIndex].id,
                user_answer: selected,
                is_correct: isCorrect
            });

            // æ˜¾ç¤ºæ­£ç¡®/é”™è¯¯
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                if (btn.textContent.includes(correct)) {
                    btn.classList.remove('btn-outline');
                    btn.classList.add('btn-success');
                } else if (btn.textContent.includes(selected) && !isCorrect) {
                    btn.classList.remove('btn-outline');
                    btn.classList.add('btn-error');
                }
            });

            // å»¶è¿Ÿåæ˜¾ç¤ºä¸‹ä¸€é¢˜
            setTimeout(() => {
                nextQuestion();
            }, 1000);
        }

        // æ˜¾ç¤ºæç¤º
        function showHint() {
            document.getElementById('hintArea').style.display = 'flex';
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            showQuestion(currentIndex + 1);
        }

        // æ˜¾ç¤ºå®Œæˆç•Œé¢
        function showComplete() {
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('completeArea').style.display = 'block';

            const correct = answers.filter(a => a.is_correct).length;
            const total = questions.length;
            const accuracy = Math.round((correct / total) * 100);

            document.getElementById('correctCount').textContent = correct;
            document.getElementById('totalCount').textContent = total;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // ç”ŸæˆPrompt
        async function generatePrompt() {
            try {
                const response = await fetch('/api/practice/prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        questions: questions,
                        style: 'gentle',
                        include_hints: true
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('promptText').textContent = data.data.prompt;
                    document.getElementById('promptArea').style.display = 'block';
                    document.getElementById('promptArea').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                console.error('ç”ŸæˆPromptå¤±è´¥:', error);
                alert('ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // å¤åˆ¶Prompt
        function copyPrompt() {
            const text = document.getElementById('promptText').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // å…³é—­Prompt
        function closePrompt() {
            document.getElementById('promptArea').style.display = 'none';
        }
    </script>
</body>
</html>
